<!DOCTYPE html>
<html>
    <head>
    	<title>Dining with 'Rona</title>
    	<meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="icon" type="image/gif/png" href="cropped_corona_logo.png">
        <script src="https://kit.fontawesome.com/9cb41bb1f0.js" crossorigin="anonymous"></script>
        <script src="http://code.jquery.com/jquery-1.5.js"></script>
             <script>
              function countChar(val) {
                var len = val.value.length;
                if (len >= 10000) {
                  val.value = val.value.substring(50, 10000);
                } else {
                  $('#charNum').text(100 - len);
                }
              };
            </script>
     <style>
        body{background-color:#fbf7f5;}
        h1 {font-family: 'PT Serif', sans-serif; color: #000;text-align: center;font-size: 40px;margin-top: 25px;}
        h2 {color: #000;text-align: center;font-family: 'PT Serif', sans-serif;}
        h3 {color: #000;text-align: center;font-family: 'PT Serif', sans-serif;}
        p {text-align: center;color:#000;font-family: 'PT Serif', sans-serif;font-size: 20px;}
        a {color:#0066CC;}
        a:hover{color:#0000FF;}
        input{font-size: 100%;font-family: verdana;align-items: center;}
        button {text-align: center;color: white;font-family: 'PT Serif', serif;background-color: #4b8b96;align-items: center;border: none;font-size: 100%;border-radius: 8px;
            border: none;
              color: white;
              padding: 16px 32px;
              text-align: center;
              font-size: 16px;
              margin: 4px 2px;
              opacity: 0.9;
              transition: 0.3s;
              display: inline-block;
              text-decoration: none;
              cursor: pointer;
        }
        
        div {text-align: center;}
        .container-name div {
            display: inline-block;
          }
        
        .special:hover {
            opacity: 1;
            
        }
        
        .bro{
            font-size:25px;
            text-align: left;
        }
        
        ul.b {
          list-style-type: square;
        }

        
        /* The sidebar menu */
        
        .round{border-radius:60%;}
        .sidenav {
          height: 100%; /* Full-height: remove this if you want "auto" height */
          width: 250px; /* Set the width of the sidebar */
          position: fixed; /* Fixed Sidebar (stay in place on scroll) */
          z-index: 1; /* Stay on top */
          top: 0; /* Stay at the top */
          left: 0;
          background-color: #4b8b96; 
          overflow-x: hidden; /* Disable horizontal scroll */
          padding-top: 20px;
        }
        
        /* The navigation menu links */
        .sidenav a {
          padding: 6px 8px 6px 16px;
          text-decoration: none;
          font-size: 25px;
          color: #ffffff;
          display: block;
          font-family: 'PT Serif', sans-serif; 
        }
        
/*
        When you mouse over the navigation links, change their color 
        .sidenav a:hover {
          color: #ffffff;
        }
*/
        
        /* Style page content */
        .main {
          margin-left: 250px; /* Same as the width of the sidebar */
          padding: 0px 10px;
        }
        

        
        /* Dropdown Button */
        .dropbtn {
          background-color: #4CAF50;
          color: white;
          padding: 16px;
          font-size: 16px;
          border: none;

        }
        
        /* The container <div> - needed to position the dropdown content */
        .dropdown {
          position: relative;
          display: inline-block;
        }
        
        /* Dropdown Content (Hidden by Default) */
        .dropdown-content {
          display: none;
          position: absolute;
          background-color: #f1f1f1;
          min-width: 160px;
          box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
          z-index: 1;
        }
        
        /* Links inside the dropdown */
        .dropdown-content a {
          color: black;
          padding: 12px 16px;
          text-decoration: none;
          display: block;
        }
        
        /* Change color of dropdown links on hover */
        .dropdown-content a:hover {background-color: #ddd;}
        
        /* Show the dropdown menu on hover */
        .dropdown:hover .dropdown-content {display: block;}
        
        /* Change the background color of the dropdown button when the dropdown content is shown */
        .dropdown:hover .dropbtn {background-color: #3e8e41;}

        *{
            box-sizing: border-box;
        }

        .rating-box{
            background-color: #9d0700;
            width: 600px;
            margin:20px auto;
            padding-top: 20px;
            padding-bottom:20px;
            padding-left:50px;
            padding-right:50px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2), 0 3px 10px 0 rgba(0,0,0,0.19);
            border-radius: 4px;
            text-align: center;
            

        }

        .rating-box h1{
            margin:0 0 30px;
            font-size: 40px;
            display: inline-block;
            text-align:center;
        }
        .rating-box .ratings .fa{
          font-size: 40px;
          color:#9cf7ff;
          float: center;
          cursor: pointer;
        }
        
        .fa{
          font-size: 40px;
          color:#9cf7ff;
        }
        
        .fas{
           font-size: 60px;
           color:#ffffff;
           float: center;
           cursor: pointer; 
        }

        .left_floater{
            float:left;
            text-align:left;
        }
        
        .right_floater{
            float:right;
            overflow: auto;
            text-align: center;
        }
        
        .rating-box input{
            margin-top: 20px;
            font-size:30px;
            padding:6px 12px;
            background-color: #bbb;
            overflow: auto;
        }
        
        .buttonFancy{
          background-color: #9c0700;
          border: none;
          color: white;
          padding: 16px 32px;
          text-align: center;
          font-size: 16px;
          margin: 4px 2px;
          opacity: 0.85;
          transition: 0.3s;
          display: inline-block;
          text-decoration: none;
          cursor: pointer;
          width: 100%;
        }
        
        .buttonFancy:hover {opacity: 1}
         
        ul.a {list-style-type: circle;display: inline-block;text-align:left;} 
        
        .loader {
          /*border: 16px solid #f3f3f3;*/
          /*border-radius: 50%;*/
          /*border-top: 16px solid #3498db;*/
          width: 120px;
          height: 120px;
          -webkit-animation: spin 2s linear infinite; /* Safari */
          animation: spin 2s linear infinite;
          text-align: center;
        }
        
        /* Safari */
        @-webkit-keyframes spin {
          0% { -webkit-transform: rotate(0deg); }
          100% { -webkit-transform: rotate(360deg); }
        }
        
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
        
        .my_img {
            max-width:40%;
            margin-bottom:20px
        }
        
        /* On smaller screens, where height is less than 500px, change the style of the sidebar (less padding and a smaller font size) */
        @media screen and (max-width: 1070px) {
            .left_floater{float:none;text-align:center;}
            .right_floater{float:none;}
            .bro{text-align:center;}
            .rating-box{width:100%;}
        }
        
        @media screen and (max-width: 650px) {
            .sidenav {padding-top:10px;}
            .sidenav a {font-size: 20px;padding-top:30px;padding-bottom:30px;}
            .my_img{padding-top:0px;margin-bottom:0px;max-width:100%;padding-right:5px;padding-left:5px;}
            h1 {font-size: 25px;}
            p {font-size: 15px;text-align:center;}
            .bro{font-size:20px;text-align:center;}
            .sidenav {width: 25%;} /* Set the width of the sidebar */
            .main {margin-left: 25%; }
            .rating-box .ratings .fa{font-size: 20px;}
            .rating-box h1{font-size: 20px;}
            .fas{font-size: 30px;}
            .fa{font-size: 20px;}
            .left_floater{float:none;text-align:center;}
            .right_floater{float:none;}
            .buttonFancy{padding: 4px 8px;opacity:1;}
            button{opacity:1;}
            .rating-box{width: 100%;text-align: left;}
            #thank-you{ display: flex; align-items: center;justify-content: center;}
        }
     </style>  
    </head>
    
    {{!-----------------------------------------------------------}}
    {{!-----------------------------------------------------------}}
    {{!-----------------------------------------------------------}}
    {{!-----------------------------------------------------------}}
    {{!-----------------------------------------------------------}}

    <body>
            
            <div class="sidenav">
                    <img src="cropped_corona_logo.png" alt="the_logo" class = "my_img" id="my_img">
                    <a onclick="option1()" href="#" id="opt1" style="background-color:#9c0700">Search</a>
                    <a onclick="option2()" href="#" id="opt2">Write a Review</a>
                    <a onclick="option3()" href="#" id="opt3">About</a>
                    
            </div>
            
            <div class="main">
                <div>
                    <h1>Dining with 'Rona</h1>
                </div>
                <div id = "search_div">
                    <p>Enter a zipcode or a zipcode and restaurant name to <b>SEARCH</b> for a restaurant.</p>
                    <form id="zipcode_entered">
                        <input type="input" value = "" id="zipcode" name="zip" placeholder="zipcode"><br>
                        <input type="input" value = "" id="next_page_token" name="rest_id" placeholder="restaurant (optional)"><br>
                    </form> 
                    <br>
                    <button class="special" id = "enter" onclick="enter()">Search</button>
                    <br>
                    <div class="loader" style="display: none;" id="my_loader">
                        <img src="cropped_corona_logo.png" alt="the_logo" style="max-width:100%">
                    </div>
                    <br>

                    
                    <form id="id_entered">
                        <input type="input" value = "" id="print" name="rest_id" placeholder="Hello" style="display:none"><br>
                    </form>
                    <form id="id_entered_part_2">
                        <input type="input" value = "" id="url" name="r_id" placeholder="Hello" style="display:none"><br>
                    </form>
                    <br>
                    <div id="choose_a_restaurant"></div>
                    <p id = "my_list"></p>
                </div>
                
                
                
                
                
                
                
                <div id = "review_div" style="display:none">
                    <div id="restaurant-selector">
                        <p>Please select a restaurant to <b>REVIEW</b> their pandemic response.</p>
                        <form id="my_one_restaurant">
                            <input type="input" value = "" id="one_zipcode" name="one_zip" placeholder="zipcode"><br>
                            <input type="input" value = "" id="one_restaurant" name="one_rest" placeholder="restaurant"><br>
                        </form> 
                        <br>
                        <button class = "special" onclick="picked()" id = "select_my_restaurant">Select</button>
                        <br>
                        <div class="loader" style="display: none;" id="my_loader_2">
                            <img src="cropped_corona_logo.png" alt="the_logo" style="max-width:100%">
                        </div>
                        <br>

                        <p id="one_search_results"></p>
                        <div id="queried_restaurants">
                            
                        </div>
                        
                    </div>    
                    
                    <div id="rating_system">
                        <div class="rating-box"  >
                        <p id="questions" style="color:#ffffff;font-size:25px"></p>
                        <div class="ratings" display: style="text-align:center;" id="stars">
                             <span class="fa fa-star-o"></span>
                             <span class="fa fa-star-o"></span>
                             <span class="fa fa-star-o"></span>
                             <span class="fa fa-star-o"></span>
                             <span class="fa fa-star-o"></span>
                        </div>
                        <br>
                        <p id="thank-you" style="display:inline-block;color:#ffffff">1 of 4 questions</p>
                        </div>
                    </div>
                    

                     <br>
                     <div id="complete_review" style="text-align:center;">
                         <button class = "special" style="background-color:#1c8832;font-size:30px;float:center;width=200px" onclick="submit()" >Submit</button>
                    </div>
                    <br>
                    <button id="cancel_button" class = "special" style="background-color:#9d0700;font-size:20px;float:center;width=200px" onclick="cancel()" >Cancel </button>

                    <div id="final_thanks" style="display:none;max-width:70%">
                        <p style="text-align:center;"><b>Thank you for your review!</b><br><br> You are helping other customers make informed choices about where they eat to protect their health.<br><br>Note: Your review may take a few moments to appear if you search for it.</p>
                        
                    </div>

                    <form id="log_rating" style="display:none">
                        <input type="input" value = "" id="log_rest_id" name="rest_id"><br>
                        <input type="input" value = "" id="log_stars" name="a_rating"><br>
                        <input type="input" value = "" id="log_comment" name="com"><br>
                        
                    </form> 
                    
                </div>
                
                
                
                
                
                
                
                <div id="about_div" style="width:80%;display:none;" >
                    <p style="text-align:left;">Dining with 'Rona puts the power back in peoples' hands to make conscientious choices about where to eat. By reviewing and reading reviews, customers can support small businesses that are doing their best to follow safe practices to fight the spread of coronavirus. Other customers can read reviews to safely dine in the time of coronavirus.</p> 
                    <p style="text-align:left;">This website was coded by Clare Heinbaugh and Emilio Luz-Ricca. Art was created by Ellie Callahan, and Eleanor Heinbaugh helped with design.</p>
                    <br>
                    <p><b>Review the website <a href ="https://docs.google.com/forms/d/e/1FAIpQLScm6EZr8JcrZnyWTqMOErwuKGKBhiFPv4-HOLmDNAmKqrU_6A/viewform">here</a>.</b></p>
                    <br>
                    <p>
                        <i class="fas fa-people-arrows" style="color:#4b8b96;pointer-events: none;"></i>
                        &nbsp &nbsp &nbsp
                        <i class="fas fa-head-side-mask" style="color:#4b8b96;pointer-events: none;"></i>
                        &nbsp &nbsp &nbsp
                        <i class="fas fa-hand-sparkles" style="color:#4b8b96;pointer-events: none;"></i>
                    </p>

                    
                </div>
        
            </div>

    {{!-----------------------------------------------------------}}
    {{!-----------------------------------------------------------}}
    {{!-----------------------------------------------------------}}
    {{!-----------------------------------------------------------}}
    {{!-----------------------------------------------------------}}

        
    {{!--<!--LOAD JQUERY-->--}}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script type = "text/javascript">
        
        document.getElementById("review_div").style.display="none";
        document.getElementById("about_div").style.display="none";
        
        function option1(){
            resetReview()
            resetSearch()
            document.getElementById("search_div").style.display="inline-block";
            document.getElementById("review_div").style.display="none";
            document.getElementById("about_div").style.display="none";
            document.getElementById("opt1").style.backgroundColor="#9c0700";
            document.getElementById("opt2").style.backgroundColor="#4b8b96";
            document.getElementById("opt3").style.backgroundColor="#4b8b96";
        }
        
        function option2(){
            resetReview()
            resetSearch()
            document.getElementById("search_div").style.display="none";
            document.getElementById("review_div").style.display="inline-block";
            document.getElementById("about_div").style.display="none";
            document.getElementById("opt1").style.backgroundColor="#4b8b96";
            document.getElementById("opt2").style.backgroundColor="#9c0700";
            document.getElementById("opt3").style.backgroundColor="#4b8b96";        
            
        }
        
        function option3(){
            resetReview()
            resetSearch()
            document.getElementById("search_div").style.display="none";
            document.getElementById("review_div").style.display="none";
            document.getElementById("about_div").style.display="inline-block";
            document.getElementById("opt1").style.backgroundColor="#4b8b96";
            document.getElementById("opt2").style.backgroundColor="#4b8b96";
            document.getElementById("opt3").style.backgroundColor="#9c0700";         
        }
        
        
        //allow user to search by pressing the enter key 
        function doIt(event) {
              var x = event.keyCode;
              if (x == 13) {  
                enter();
            }
        }
        
        ///////////////////////////////////////////////////////////////////////////////
        ////Search functionality///////
        ///////////////////////////////////////////////////////////////////////////////
        var replace_in_button = [];
        var all_comments = {};
        var all_button_rest_ids = {};
        var sort_buttons = {};
        
        function enter(){
            replace_in_button = [];
            
            const myNode = document.getElementById("choose_a_restaurant");
            myNode.innerHTML = ''
            
            document.getElementById("enter").style.display = "none";
            document.getElementById("my_loader").style.display = "inline-block";
            
            var myDiv = document.getElementById("my_list")
            myDiv.innerHTML="";
            
            
            $.ajax({
                url: "nearby_restaurants", 
                type: "get",     
                data:  $('#zipcode_entered').serialize(), //serialize form and pass to server
                success: function(response) {
                        document.getElementById("my_loader").style.display = "none";
                        document.getElementById("enter").style.display = "inline-block";
                        
                        if(response==="Invalid"){
                            var myDiv = document.getElementById("my_list")
                            myDiv.innerHTML="Invalid zipcode.<br>Please enter a valid, 5-digit zipcode.";
                        }
                        else if(response===""){
                            var myDiv = document.getElementById("my_list")
                            myDiv.innerHTML="No results of search."; 
                        }
                        else{
                            list_restaurants(response)
                        }
                    },
                    error: function (stat, err) {
                        console.log("error")
                    }       
                });
            }
        
        function list_restaurants(resp){

            all_rests_fancy = []
            
            list_of_rests = (resp.split("`"));
            nice_format = ""
            for(let h = 0; h < list_of_rests.length; h++){
                cur_rest = list_of_rests[h].split("~");
                my_rest_fancy = []
                for(let r = 0; r < cur_rest.length; r++){
                    nice_format += cur_rest[r]+"<br>";
                    my_rest_fancy.push(cur_rest[r])
                }
                all_rests_fancy.push(my_rest_fancy)
            }
            
            for(let q = 0; q<all_rests_fancy.length; q++){
                var myButton = document.createElement("button");        // Create a new button 
                myButton.setAttribute('class', 'buttonFancy');
                myButton.setAttribute("id","button"+q);
                myButton.style.background='#9c0700';
                // all_button_rest_ids[all_rests_fancy[q][2]] = "";

                myButton.addEventListener('click', function(){
                    work(all_rests_fancy[q][2], this.id);
                });
                sort_buttons[myButton] = rate(all_rests_fancy, myButton.id)
                
                
                document.getElementById("choose_a_restaurant").appendChild(myButton);     // Append button to <div> with id="queried_restaurants"
            }
            

    }
    
    //var previous_button = "button0"
    
    
    function work(restaurant_id, my_id){
        
        //only allow user to open one button at a time
        if(replace_in_button.length > 0){
            var prevButton = document.getElementById(replace_in_button[0]);
            prevButton.innerHTML = replace_in_button[1];
            replace_in_button = [];
            var aButton = document.getElementById(my_id);
            var delete_stuff = aButton.innerHTML.split("<div id=\"special_secrets\">")[0];
        
            replace_in_button.push(my_id);
            replace_in_button.push(delete_stuff);
        }
        else{
            var bButton = document.getElementById(my_id);
            
            replace_in_button.push(my_id);
            replace_in_button.push(bButton.innerHTML);
        }
        
        // var the_url = all_button_rest_ids[restaurant_id]
        // alert(JSON.stringify(all_button_rest_ids))
        
        //code to get and output restaurant URL; right now lags A LOT; 
        // $.ajax({
        //         url: "get_URL", 
        //         type: "get",     
        //         data:  $('#id_entered').serialize(), //serialize form and pass to server
        //         success: function(response) {
        //                 the_url = response
                        
        //             },
        //             error: function (stat, err) {
        //                 console.log("error")
        //             }       
        //     });
        
        
        
        if(restaurant_id in all_comments){
            //show the comments and all get the link
            var myShowyButton = document.getElementById(my_id);
            // var currentText = myShowyButton.innerHTML
            myShowyButton.innerHTML += "<div style=\"text-align:left;\" id=\"special_secrets\"><br><br><br><div style=\"text-align:left;word-wrap: break-word;\"><b>Customer feedback:</b><br>"+all_comments[restaurant_id]+"</div></div>";
    
        }
        else{
            //show the comments and all get the link
            var myShowyButton = document.getElementById(my_id);
            myShowyButton.innerHTML += "<div id=\"special_secrets\"><br><br><b>Customer feedback:</b><br>No reviews yet.</div>";
        }
        
        
        
    }
    
    
    // function add_urls(){
    //     for (var key in all_button_rest_ids){
    //         var myDiv = document.getElementById("url");
    //         myDiv.value = key;
    //         $.ajax({
    //             url: "get_URL", 
    //             type: "get",     
    //             data:  $('#id_entered_part_2').serialize(), //serialize form and pass to server
    //             success: function(response) {
    //                     all_button_rest_ids[key] = response
    //                 },
    //                 error: function (stat, err) {
    //                     console.log("error")
    //                 }       
    //         });
    //     }
    // }
    
    //get the current rating
    function rate(allRests,my_id){
        //determine the current value 
        var the_number = parseInt(my_id.split("n")[1]);
        
        var aDiv = document.getElementById("print");
        aDiv.value = allRests[the_number][2];
        
        $.ajax({
            url: "get_a_restaurant", 
            type: "get",     
            data:  $('#id_entered').serialize(), //serialize form and pass to server
            success: function(response) {
                
                // var myDiv = document.getElementById("print");
                // myDiv.value = response;
                
                //if there are no existing ratings and comments
                if(response==="None"){
                    var mySecondDiv = document.getElementById(my_id);
                    mySecondDiv.innerHTML = "<div class=\"bro\" style=\"text-align:center\">"+allRests[the_number][0]+"</div>"+allRests[the_number][1];
                    return 0;
                    
                }
                //if there are ratings and comments
                else{
                    var rating_and_comment = response.split("^");
                    var rat = rating_and_comment[0];
                    var coms = rating_and_comment[1].split("~");
                    var coms_pretty = "";
                    coms_pretty+="<ul class=\"b\">";
                    for(let g = 0; g<coms.length; g++){
                        coms_pretty += "<li>"+coms[g]+"</li>";
                    }
                    coms_pretty+="</ul>";
                    all_comments[allRests[the_number][2]] = coms_pretty

                    var array_of_stars = all_the_stars(rat);
                    var star_string = "<i class=\""+array_of_stars[0]+"\"></i><i class=\""+array_of_stars[1]+"\" ></i><i class=\""+array_of_stars[2]+"\" ></i><i class=\""+array_of_stars[3]+"\" ></i><i class=\""+array_of_stars[4]+"\"></i>"
                    //alert(star_string);
                    
                    var mySecondDiv = document.getElementById(my_id);
                    mySecondDiv.innerHTML = "<div style=\"text-align: center;\"><div class=\"left_floater\"><div class=\"bro\">"+allRests[the_number][0]+"</div>"+
                    allRests[the_number][1]+"</div>"+"<div class=\"right_floater\">"+star_string+"</div></div>";
                    //mySecondDiv.innerHTML = "<p>hello world</p>"//"<p style=\"text-align: left;\">Hello world</p>"
                    
                    return parseInt(rat)
                    
                }
                
            },
            error: function (stat, err) {
                console.log("error")
                return 0;
            }       
        });
        return 0;

    }

    function all_the_stars(floatieBoi){
        var rounded_val = Math.round(floatieBoi*2)/2;
        
        var lovely_stars = []
        if(rounded_val==0){
            lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");
        }
        else if(rounded_val==0.5){
            lovely_stars.push("fa fa-star-half-alt");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");
        }
        else if(rounded_val==1){
            lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");
        }
        else if(rounded_val==1.5){
            lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star-half-alt");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");
        }
        else if(rounded_val==2){
            lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");
        }
        else if(rounded_val==2.5){
            lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star-half-alt");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");
        }
        else if(rounded_val==3.0){
            lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");
        }
        else if(rounded_val==3.5){
            lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star-half-alt");lovely_stars.push("fa fa-star-o");
        }
        else if(rounded_val==4){
            lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star-o");
        }    
        else if(rounded_val==4.5){
            lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star-half-alt");
        } 
        else{
            lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");
        } 
        return lovely_stars;
    }
    
    function resetSearch(){
        var div1 = document.getElementById("zipcode");
        var div2 = document.getElementById("next_page_token");
        var div3 = document.getElementById("print");
        var div4 = document.getElementById("choose_a_restaurant");
        var div5 = document.getElementById("my_list");
        
        div1.value = "";
        div2.value = "";
        div3.value = "";
        div4.innerHTML = '';
        div5.innerHTML = "";
        
    }  
    
    ///////////////////////////////////////////////////////////////////////////////
    ////Review functionality///////
    ///////////////////////////////////////////////////////////////////////////////

    //global variables for restaurant identification
    selected_restaurant_name = "None" 
    selected_restaurant_id = "None" 
     
    document.getElementById("rating_system").style.display="none";
    document.getElementById("complete_review").style.display="none";
        
     function picked(){
        var anotherDiv = document.getElementById("one_search_results")
        anotherDiv.innerHTML=""; 

         
         if(document.getElementById("one_restaurant").value==""){
            var zeDiv = document.getElementById("one_search_results")
            zeDiv.innerHTML="Please enter a restaurant name."; 
         }
         else{
             document.getElementById("select_my_restaurant").style.display = "none";
             document.getElementById("my_loader_2").style.display = "inline-block";
             
             $.ajax({
                url: "search_name", 
                type: "get",     
                data:  $('#my_one_restaurant').serialize(), //serialize form and pass to server
                success: function(response) {
                        document.getElementById("select_my_restaurant").style.display = "inline-block";
                        document.getElementById("my_loader_2").style.display = "none";
                    
                        const myNode = document.getElementById("queried_restaurants");
                        myNode.innerHTML = ''
                        if(response==="Invalid"){
                            var myDiv = document.getElementById("one_search_results")
                            myDiv.innerHTML="Invalid zipcode.<br>Please enter a valid, 5-digit zipcode."; 
                        }
                        else if(response===""){
                            var myDiv = document.getElementById("one_search_results")
                            myDiv.innerHTML="No results of search."; 
                        }
                        else{
                            var myDiv = document.getElementById("one_search_results")
                            myDiv.innerHTML=""; 
                            createOptions(response);
                        }
                    },
                    error: function (stat, err) {
                        console.log("error")
                    }       
            });
         }
            

        }
    
    function createOptions(resp){
        
        all_rests_fancy = []
        
        list_of_rests = (resp.split(";"));
        nice_format = ""
        for(let h = 0; h < list_of_rests.length; h++){
            cur_rest = (list_of_rests[h]).replace("\"", "'").replace("\"", "'").split("', '");
            my_rest_fancy = []
            for(let r = 0; r < cur_rest.length; r++){
                nice_format+= cur_rest[r].replace("'", "").replace("(", "").replace(")", "").replace("(", "")+"<br>"
                my_rest_fancy.push(cur_rest[r].replace("'", "").replace("(", "").replace(")", "").replace("(", ""))
            }
            all_rests_fancy.push(my_rest_fancy)
        }
        
        // var myDiv = document.getElementById("one_search_results")
        // myDiv.innerHTML=all_rests_fancy[0]+"";
        
        for(let q = 0; q<all_rests_fancy.length; q++){
            var myButton = document.createElement("button");        // Create a new button 
            myButton.innerHTML = all_rests_fancy[q][0]+"<br>"+all_rests_fancy[q][1]+"";                // Insert text
            myButton.setAttribute('class', 'buttonFancy');
            myButton.setAttribute('id', ('button'+q));
            myButton.style.background='#9c0700';
            myButton.addEventListener('click', function(){
                review(all_rests_fancy[q]);
            });
            document.getElementById("queried_restaurants").appendChild(myButton);     // Append button to <div> with id="queried_restaurants"
            
        }

    }
    
    function review(a_restaurant){
        document.getElementById("restaurant-selector").style.display="none";
        document.getElementById("rating_system").style.display="inline-block";
        document.getElementById("cancel_button").style.display="inline-block";
        document.getElementById("stars").style.display="inline-block";
        selected_restaurant_id = a_restaurant[(a_restaurant.length-1)];
        selected_restaurant_name = a_restaurant[0] 
    }
    
    
        
     var questions_array = [
         "<i class=\"fas fa-people-arrows\"></i> <br> <br><b>Social Distancing</b>", // <br> <ul class = \"a\"><li>How well did people stay 6-feet apart?</li> <li>Were there few people inside the building at a time?</li> <li>Was it clear where to stand or wait to avoid other people?</li> <li>Were there glass or plastic separators between you and members of the staff? </li><li>In general, how well was social distancing exhibited?</li></ul> ",
         "<i class=\"fas fa-head-side-mask\"></i> <br> <br><b>Masks</b>", // <br> <ul class = \"a\"><li>Were members of the staff wearing masks?</li> <li>Did other customers wear masks?</li> <li>Was it clear where to stand or wait to avoid other people?</li> <li>Did you notice any signs posted encouraging or requiring customers to wear masks?</li></ul>",
         "<i class=\"fas fa-hand-sparkles\"></i> <br><br><b>General Hygiene</b>", //<br> <ul class = \"a\"><li>How clean was it in general?</li> <li>Were surfaces wiped down?</li> <li>Was there a way to avoid frequently touched surfaces like door handles?</li></ul>",
         //"<div ng-app=""><p>Input something in the input box:</p><p>Name : <input type=\"text\" ng-model=\"name\" placeholder=\"Enter name here\"></p><h1>{{name.length}}</h1></div>"
         "<b>Comments</b> <br> <textarea onkeyup=\"countChar(this)\" value = \"\" id=\"myTextArea\" style=\"background-color: #ffffff;height: 100px;width: 100%;font-size: 15px;resize:none\"></textarea><div style=\"text-align:right;font-size:20px;\" id=\"charNum\">100</div>"
     
     ]
     
        var answers_array = []
        
          ////////question 1
          const stars=document.querySelector(".ratings").children;
          let index;

          var c = 0;
          var myDiv = document.getElementById("questions")
          myDiv.innerHTML = questions_array[c] 
          
          for(let i=0; i<stars.length; i++){
            stars[i].addEventListener("mouseover",function(){
                for(let j=0; j<stars.length; j++){
                    stars[j].classList.remove("fa-star");		 	
                    stars[j].classList.add("fa-star-o");		 	
                 }
                 for(let j=0; j<=i; j++){
                    stars[j].classList.remove("fa-star-o");		 	
                   stars[j].classList.add("fa-star");		 	
                 }
            })
            stars[i].addEventListener("click",function(){
                var millisecondsToWait = 500;
                
                for(let j=0; j<stars.length; j++){
                    stars[j].classList.remove("fa-star");		 	
                    stars[j].classList.add("fa-star-o");		 	
                 }
                
                answers_array.push((i+1));
                // index=-1; //sets all stars back to empty
              
                var myDiv = document.getElementById("questions");
                c++;
                myDiv.innerHTML = questions_array[c];
                
                var theDiv = document.getElementById("thank-you");
                theDiv.innerHTML = (c+1)+" of 4 questions"
                
                
                if(c==questions_array.length-1){
                    finish_review()
                }

            })
            stars[i].addEventListener("mouseout",function(){

                 for(let j=0; j<stars.length; j++){
                    stars[j].classList.remove("fa-star");		 	
                    stars[j].classList.add("fa-star-o");		 	
                 }
                 for(let j=0; j<=index; j++){
                   stars[j].classList.remove("fa-star-o");		 	
                   stars[j].classList.add("fa-star");		 	
                 }
            })
          } 
        
        function finish_review(){
            console.log(answers_array);
            // var message = document.getElementById("thank-you");
            // message.innerHTML = answers_array;
            
            //selected_restaurant_id is the id of the review restaurant-selector
            var div1 = document.getElementById("log_rest_id")
            div1.value = selected_restaurant_id;
            
            //first 3 elements of answers_array are star ratings that need to be averaged
            var sum = 0;
            for(let x = 0; x<(answers_array.length); x++){
                sum += answers_array[x];
            }
            document.getElementById("log_stars").value = (sum/3).toString();
            document.getElementById("stars").style.display="none";
            document.getElementById("complete_review").style.display="inline-block";

        }
        
        //function if submit is selected on last page of review
        
        function submit(){
            //get the comments
            document.getElementById("log_comment").value = document.getElementById("myTextArea").value;
            
            var message = document.getElementById("thank-you");
            
            var a_new_div = document.getElementById("log_comment")
                
            //check if too long of a comment
            if(document.getElementById("log_comment").value.length > 100){
                message.innerHTML = "Max of 100 characters.";
            }
            else if(profanity(a_new_div.value)){
                message.innerHTML = "Please avoid profanity.";
            }
            else{
                $.ajax({
                    url: "store_rating", 
                    type: "get",     
                    data:  $('#log_rating').serialize(), //serialize form and pass to server
                    success: function(response) {
                            document.getElementById("log_stars").value = response;
    
                        },
                        error: function (stat, err) {
                            console.log("error")
                    }       
                });
            
                resetReview()
                document.getElementById("final_thanks").style.display="inline-block";
                document.getElementById("restaurant-selector").style.display="none";


            }
        }
        
        //function if cancel is selected on last page of review
        function cancel(){
            resetReview()
        }
        
        //reset all elements before next review
        function resetReview(){
            const myNode = document.getElementById("queried_restaurants");
            myNode.innerHTML = ''
            document.getElementById("restaurant-selector").style.display="inline-block";
            document.getElementById("cancel_button").style.display="none";
            document.getElementById("rating_system").style.display="none";
            document.getElementById("complete_review").style.display="none";
            document.getElementById("final_thanks").style.display="none";

            answers_array = []
            c = 0
            var myDiv = document.getElementById("questions")
            myDiv.innerHTML = questions_array[c] 
            document.getElementById("one_restaurant").value="";
            document.getElementById("one_zipcode").value="";
            var yetAnotherDiv = document.getElementById("thank-you");
            yetAnotherDiv.innerHTML = "1 of 4 questions";
            var divBoi = document.getElementById("one_search_results");
            divBoi.innerHTML = ""; 
        }
        
        //////////////////////////////////////
        /////////////General methods//////////
        
        function profanity(myString){
            const badWords = ['2g1c', 'shithole', '2 girls 1 cup', '4r5e', 'anal', 'anus', 'arse', 'ass', 'asses', 'assfucker', 'assfukka', 'asshole', 'arsehole', 'asswhole', 'assmunch', 'auto erotic', 'autoerotic', 'ballsack', 'bastard', 'beastial', 'bestial', 'bellend', 'bdsm', 'beastiality', 'bestiality', 'bitch', 'bitches', 'bitchin', 'bitching', 'bimbo', 'bimbos', 'blow job', 'blowjob', 'blowjobs', 'blue waffle', 'boob', 'boobs', 'booobs', 'boooobs', 'booooobs', 'booooooobs','boooooooobs','booooooooobs','boooooooooobs', 'breasts', 'booty call', 'brown shower', 'brown showers', 'boner', 'bondage', 'buceta', 'bukake', 'bukkake', 'bullshit', 'bull shit', 'busty', 'butthole', 'carpet muncher', 'cawk', 'chink', 'cipa', 'clit', 'clits', 'clitoris', 'cnut', 'cock', 'cocks', 'cockface', 'cockhead', 'cockmunch', 'cockmuncher', 'cocksuck', 'cocksucked', 'cocksucking', 'cocksucks', 'cocksucker', 'cokmuncher', 'coon', 'cow girl', 'cow girls', 'cowgirl', 'cowgirls', 'crap', 'crotch', 'cum', 'cummer', 'cumming', 'cuming', 'cums', 'cumshot', 'cunilingus', 'cunillingus', 'cunnilingus', 'cunt', 'cuntlicker', 'cuntlicking', 'cunts', 'damn', 'dick', 'dickhead', 'dildo', 'dildos', 'dink', 'dinks', 'deepthroat', 'deep throat', 'dog style', 'doggie style', 'doggiestyle', 'doggy style', 'doggystyle', 'donkeyribber', 'doosh', 'douche', 'duche', 'dyke', 'ejaculate', 'ejaculated', 'ejaculates', 'ejaculating', 'ejaculatings', 'ejaculation', 'ejakulate', 'erotic', 'erotism', 'fag', 'faggot', 'fagging', 'faggit', 'faggitt', 'faggs', 'fagot', 'fagots', 'fags', 'fatass', 'femdom', 'fingering', 'footjob', 'foot job', 'fuck', 'fucks', 'fucker', 'fuckers', 'fucked', 'fuckhead', 'fuckheads', 'fuckin', 'fucking', 'fcuk', 'fcuker', 'fcuking', 'felching', 'fellate', 'fellatio', 'fingerfuck', 'fingerfucked', 'fingerfucker', 'fingerfuckers', 'fingerfucking', 'fingerfucks', 'fistfuck', 'fistfucked', 'fistfucker', 'fistfuckers', 'fistfucking', 'fistfuckings', 'fistfucks', 'flange', 'fook', 'fooker', 'fucka', 'fuk', 'fuks', 'fuker', 'fukker', 'fukkin', 'fukking', 'futanari', 'futanary', 'gangbang', 'gangbanged', 'gang bang', 'gokkun', 'golden shower', 'goldenshower', 'gaysex', 'goatse', 'handjob', 'hand job', 'hentai', 'hooker', 'hoer', 'homo', 'horny', 'incest', 'jackoff', 'jack off', 'jerkoff', 'jerk off', 'jizz', 'knob', 'kinbaku', 'labia', 'masturbate', 'masochist', 'mofo', 'mothafuck', 'motherfuck', 'motherfucker', 'mothafucka', 'mothafuckas', 'mothafuckaz', 'mothafucked', 'mothafucker', 'mothafuckers', 'mothafuckin', 'mothafucking', 'mothafuckings', 'mothafucks', 'mother fucker', 'motherfucked', 'motherfucker', 'motherfuckers', 'motherfuckin', 'motherfucking', 'motherfuckings', 'motherfuckka', 'motherfucks', 'milf', 'muff', 'nigga', 'nigger', 'nigg', 'nipple', 'nipples', 'nob', 'nob jokey', 'nobhead', 'nobjocky', 'nobjokey', 'numbnuts', 'nutsack', 'nude', 'nudes', 'orgy', 'orgasm', 'orgasms', 'panty', 'panties', 'penis', 'playboy', 'porn', 'porno', 'pornography', 'pron', 'pussy', 'pussies', 'rape', 'raping', 'rapist', 'rectum', 'retard', 'rimming', 'sadist', 'sadism', 'schlong', 'scrotum', 'sex', 'semen', 'shemale', 'she male', 'shibari', 'shibary', 'shit', 'shitdick', 'shitfuck', 'shitfull', 'shithead', 'shiting', 'shitings', 'shits', 'shitted', 'shitters', 'shitting', 'shittings', 'shitty', 'shota', 'skank', 'slut', 'sluts', 'smut', 'smegma', 'spunk', 'strip club', 'stripclub', 'tit', 'tits', 'titties', 'titty', 'titfuck', 'tittiefucker', 'titties', 'tittyfuck', 'tittywank', 'titwank', 'threesome', 'three some', 'throating', 'twat', 'twathead', 'twatty', 'twunt', 'viagra', 'vagina', 'vulva', 'wank', 'wanker', 'wanky', 'whore', 'whoar', 'xxx', 'xx', 'yaoi', 'yury'];
            return badWords.some(word => myString.includes(word));
        }
        
        
    </script>

        
        
    </body>
</html>

