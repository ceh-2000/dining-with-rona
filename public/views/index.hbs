<!DOCTYPE html>
<html>
    <head>
    	<title>Dining with 'Rona</title>
        <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' />
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500&display=swap" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="icon" type="image/gif/png" href="corona_boi.png">
        <script src="https://kit.fontawesome.com/9cb41bb1f0.js" crossorigin="anonymous"></script>
        <script src="http://code.jquery.com/jquery-1.5.js"></script>
             <script>
              function countChar(val) {
                var len = val.value.length;
                if (len >= 10000) {
                  val.value = val.value.substring(50, 10000);
                } else {
                  $('#charNum').text(100 - len);
                }
              };
            </script>
     <style>
        body{background-color:#fbf7f5;margin: 0;padding: 0;}
        html {margin: 0;padding: 0;}
        h1 {font-family: 'Montserrat', sans-serif; color: #000;text-align: center;font-size: 40px;margin-top: 25px;}
        h2 {color: #000;text-align: center;font-family: 'Montserrat', sans-serif;}
        h3 {color: #000;text-align: center;font-family: 'Montserrat', sans-serif;}
        p {text-align: center;color:#000;font-family: 'Montserrat', sans-serif;font-size: 20px;}
        a {color:#0066CC;}
        a:hover{color:#0000FF;}
        input{font-size: 22px;font-family: 'Montserrat', sans-serif;align-items: center;}
        /*CHANGE BUTTONS ELEANOR*/
        button {text-align: center;color: white;font-family: 'Montserrat', sans-serif;
            background-color: #a9e3ff;align-items: center;border: none;font-size: 100%;border-radius: 8px;
            border: none;
              color: black;
              padding: 16px 32px;
              text-align: center;
              font-size: 20px;
              margin: 4px 2px;
              opacity: 0.9;
              transition: 0.3s;
              display: inline-block;
              text-decoration: none;
              cursor: pointer;
              box-shadow: 0 2px 4px 0 rgba(0,0,0,0.2), 0 1px 3px 0 rgba(0,0,0,0.19);

        }
        
        div {text-align: center;}
        .container-name div {
            display: inline-block;
          }
        
        .special:hover {
            opacity: 1;
            
        }
        
        .bro{
            font-size:25px;
            text-align: left;
        }
        
        ul.b {
          list-style-type: square;
        }

        
        /* The sidebar menu */
        
        .round{border-radius:60%;}
        /*CHANGE SIDE BAR ELEANOR*/
        .sidenav {
          height: 100%; /* Full-height: remove this if you want "auto" height */
          width: 250px; /* Set the width of the sidebar */
          position: fixed; /* Fixed Sidebar (stay in place on scroll) */
          z-index: 1; /* Stay on top */
          top: 0; /* Stay at the top */
          left: 0; /* Stay on the left */
          background-color: #a9e3ff; 
          overflow-x: hidden; /* Disable horizontal scroll */
          padding-top: 20px;
        }
        
        /* The navigation menu links */
        .sidenav a {
          padding: 6px 8px 6px 16px;
          text-decoration: none;
          font-size: 25px;
          color: #000;
          display: block;
          font-family: 'Montserrat', sans-serif;
        }
        
/*
        When you mouse over the navigation links, change their color 
        .sidenav a:hover {
          color: #ffffff;
        }
*/
        
        /* Style page content */
        .main {
          margin-left: 250px; /* Same as the width of the sidebar */
          overflow:auto;
        }
        
        /* Place the navbar at the bottom of the page, and make it stick */
        .navbar_bottom {
          width: 100%;
          background-color: #ace4fb;
          overflow: hidden;  
          position: fixed;
          bottom: 0;
          width: 100%;
          display: none;
        }
        
        /* Style the links inside the navigation bar */
        .navbar_bottom a {
          float: left;
          padding-top: 15px;
          padding-bottom: 15px;
          color: white;
          text-decoration: none;
          font-size: 17px;
          width: 33.33%; /* Four equal-width links. If you have two links, use 50%, and 33.33% for three links, etc.. */
          text-align: center; /* If you want the text to be centered */
        }
        
        /* Change the color of links on hover */
        /*.navbar_bottom a:hover {*/
        /*  background-color: #ddd;*/
        /*  color: black;*/
        /*}*/
        
        /* Add a color to the active/current link */
        /*.navbar_bottom a.active {*/
        /*  background-color: #4CAF50;*/
        /*  color: white;*/
        /*}*/
        
        
        .rating-box{
            background-color: #de142b;
            width: 600px;
            margin:20px;
            padding-top: 20px;
            padding-bottom:20px;
            padding-left:50px;
            padding-right:50px;
            display: inline-block;
            flex-direction: column;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2), 0 3px 10px 0 rgba(0,0,0,0.19);
            border-radius: 4px;
            text-align: center;
            

        }

        .rating-box h1{
            margin:0 0 30px;
            font-size: 40px;
            display: inline-block;
            text-align:center;
        }
        
        .textclare{
          background-color: #ffffff;
          font-size: 15px;
          resize:none;
          height:100px;
          width:500px
        }
        
        .rating-box .ratings .fa{
          font-size: 40px;
          color:#ffffff;
          float: center;
          cursor: pointer;
        }
        
        .fa{
          font-size: 40px;
          color:#ffffff;
        }
        
        .fas{
           font-size: 60px;
           color:#ffffff;
           float: center;
           cursor: pointer; 
        }

        .left_floater{
            float:left;
            text-align:left;
        }
        
        .right_floater{
            float:right;
            overflow: auto;
            text-align: center;
        }
        /*ELEANOR*/
        .buttonFancy{
          background-color:#de142b;
          border: none;
          color: black;
          padding: 16px 32px;
          text-align: center;
          font-size: 16px;
          margin: 4px 2px;
          opacity: 0.85;
          transition: 0.3s;
          display: inline-block;
          text-decoration: none;
          cursor: pointer;
          width: 100%;
          box-shadow: 0 2px 4px 0 rgba(0,0,0,0.2), 0 1px 3px 0 rgba(0,0,0,0.19);

        }
        
        .buttonFancy:hover {opacity: 1}
         
        ul.a {list-style-type: circle;display: inline-block;text-align:left;font-size:20px;font-family: 'Montserrat', sans-serif;} 
        
        .loader {
          /*border: 16px solid #f3f3f3;*/
          /*border-radius: 50%;*/
          /*border-top: 16px solid #3498db;*/
          width: 120px;
          height: 120px;
          -webkit-animation: spin 2s linear infinite; /* Safari */
          animation: spin 2s linear infinite;
          text-align: center;
        }
        
        /* Safari */
        @-webkit-keyframes spin {
          0% { -webkit-transform: rotate(0deg); }
          100% { -webkit-transform: rotate(360deg); }
        }
        
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
        
        .my_img {
            max-width:40%;
            margin-bottom:20px
        }
        
        .topnav {
            overflow: hidden;
            position: fixed;
            top: 0;
            width: 100%;
            display: none;
            height: 50px;
            background-color: #a9e3ff;
            text-align: center;
            padding-bottom: 20px;
            margin-top: -10px;
            }
                
        /* On smaller screens, where height is less than 500px, change the style of the sidebar (less padding and a smaller font size) */
        @media screen and (max-width: 1070px) {
            .left_floater{float:none;text-align:center;}
            .right_floater{float:none;}
            .bro{text-align:center;}
            .rating-box{width:100%;margin-left:-10px;padding-right:20px;padding-left:20px;}
        }
        
        @media screen and (max-width: 650px) {
            .sidenav a {font-size: 20px;padding-top:30px;padding-bottom:30px;}
            .my_img{padding-top:0px;margin-bottom:0px;max-width:100%;padding-right:5px;padding-left:5px;}
            h1 {font-size: 25px;}
            p {font-size: 18px;text-align:center;}
            .bro{font-size:20px;text-align:center;}
            .sidenav {padding:0; margin:0;display:none;} /* Set the width of the sidebar */
            .main {margin-left: 0%; margin-bottom:70px; margin-top:60px;} /*changed for mobile view*/
            .rating-box .ratings .fa{font-size: 30px;}
            .rating-box h1{font-size: 30px;}
            .fas{font-size: 30px;}
            .fa{font-size: 20px;}
            .left_floater{float:none;text-align:center;}
            .right_floater{float:none;}
            .buttonFancy{padding: 4px 8px;opacity:1;}
            button{opacity:1;padding-top:15px;padding-bottom:15px;margin:0px;}
            .rating-box{width: 100%;text-align: center;padding-top:0px;margin-top:20px;padding-bottom:0px;}
            #thank-you{ display: flex; align-items: center;}
            .navbar_bottom{display:inline-block;}
            #entire_bottom{display:inline-block;}
            .textclare{width:100%;margin-left:-5px;}
            input{font-size:18px;}
            #web_topnav{display:none;}
            .topnav{display:inline-block;}
            #submit{margin-bottom:10px;}
            #about_1{font-size:15px;}
            #about_2{font-size:15px;}
            ul.a{font-size:15px;}
        }

     </style>  
    </head>
    
    {{!-----------------------------------------------------------}}
    {{!-----------------------------------------------------------}}
    {{!-----------------------------------------------------------}}
    {{!-----------------------------------------------------------}}
    {{!-----------------------------------------------------------}}

    <body>
            
            <div class="sidenav">
                    <img src="rona_icon_original.png" alt="the_logo" class = "my_img" id="my_img">
                    {{!--ELEANOR--}}
                    <a onclick="option1()" href="#search" id="opt1" style="background-color:#fae205">Search</a>
                    <a onclick="option2()" href="#review" id="opt2" style="background-color:#a9e3ff">Review a Restaurant</a>
                    <a onclick="option3()" href="#about" id="opt3" style="background-color:#a9e3ff">About</a>
                    
            </div>
            <div class="topnav">
                    <table style="text-align:center;margin-left: auto;margin-right: auto;max-width: 1000px;float: none;">
                        <tr>
                            <td>
                                <img src="rona_icon_original.png" alt="the_logo" class = "my_img" id="my_img" style="float:left;width:40px;">
                            </td>
                            <td>
                                <h1><b>Dining with 'Rona</b></h1>
                            </td>
                        </tr>
                    </table>
                </div>
                
            <div class="main">
                <div id="web_topnav">
                    <h1>Dining with 'Rona</h1>
                </div>
                
                <div id = "search_div" style="display:inline-block;max-width:80%;">
                    <p style="text-align:center;"><b>SEARCH</b> for a restaurant.</p>
                    <form id="zipcode_entered">
                        <input type="input" value = "" id="zipcode" name="zip" placeholder="zipcode, city, state" style="margin-bottom:10px;"><br>
                        <input type="input" value = "" id="next_page_token" name="rest_id" placeholder="restaurant (optional)"><br>
                    </form> 
                    <br>
                    <button class="special" id = "enter" onclick="enter()">Search</button>
                    <br>
                    <div class="loader" style="display: none;" id="my_loader">
                        <img src="rona_icon_original.png" alt="the_logo" style="max-width:100%">
                    </div>
                    <br>
                    <br>
                    <button id="reload_button" class="special" style="background-color:#de142b;color:#ffffff;display:none" onclick="reload()">Cancel<br>Search</button>
                    
                    <form id="id_entered">
                        <input type="input" value = "" id="print" name="rest_id" placeholder="Hello" style="display:none"><br>
                    </form>
                    <form id="id_entered_part_2">
                        <input type="input" value = "" id="url" name="r_id" placeholder="Hello" style="display:none"><br>
                    </form>
                    <div id="choose_a_restaurant"></div>
                    <p id = "my_list" style="text-align: justify;">Hello! By reviewing and reading reviews, customers can support small businesses that are doing their best to follow safe practices to fight the spread of coronavirus.</p>
                    <p id="space_search"></p>
                </div>
                
                
                
                
                
                
                
                <div id = "review_div" style="display:none">
                    <div id="restaurant-selector" style="display:inline-block;max-width:80%;">
                        <p style="text-align:center;">Please select a restaurant to <b>REVIEW</b> their pandemic response.</p>
                        <form id="my_one_restaurant">
                            <input type="input" value = "" id="one_zipcode" name="one_zip" placeholder="zipcode, city, state" style="margin-bottom:10px;"><br>
                            <input type="input" value = "" id="one_restaurant" name="one_rest" placeholder="restaurant"><br>
                        </form> 
                        <br>
                        <button class = "special" onclick="picked()" id = "select_my_restaurant">Search</button>
                        <br>
                        <div class="loader" style="display: none;" id="my_loader_2">
                            <img src="corona_boi.png" alt="the_logo" style="max-width:100%">
                        </div>
                        <br>

                        <p id="one_search_results"></p>
                        <div id="queried_restaurants">
                            
                        </div>
                        <br>
                        <button id="reload_button2" class="special" style="background-color:#de142b;color:#ffffff;display:none" onclick="reload2()">Cancel<br>Search</button>
                    
                        
                    </div>    
                    
                    <div id="rating_system" style="text-align:center;margin-left:-10px">
                        <div class="rating-box">
                        <p id="questions" style="color:#ffffff;font-size:25px"></p>
                        <div class="ratings" display: style="text-align:center;" id="stars">
                             <span class="fa fa-star-o"></span>
                             <span class="fa fa-star-o"></span>
                             <span class="fa fa-star-o"></span>
                             <span class="fa fa-star-o"></span>
                             <span class="fa fa-star-o"></span>
                        </div>
                        <div id="comment_for_reviews" style="display:none">
                            <p style="font-size:30px;color:#ffffff"><b>Comments</b> </p>
                            <div style="display:inline-block;text-align:center;">
                                <textarea onkeyup="countChar(this)" value = "" id="myTextArea" class="textclare" ></textarea>
                            </div>
                            <div style="text-align:right;font-size:20px;color:#ffffff" id="charNum">100</div>
                        </div>
                        <br>
                        <p id="thank-you" style="display:inline-block;color:#ffffff">1 of 4 questions</p>
                        </div>
                    </div>
                    
                     <br>
                     <div id="complete_review" style="text-align:center;">
                         <button class = "special" id="submit" style="background-color:#077800;color:#ffffff;font-size:30px;float:center;width=200px" onclick="submit()" >Submit</button>
                    </div>
                    <br>
                    <button id="cancel_button" class = "special" style="background-color:#de142b;color:#ffffff;font-size:20px;float:center;width=200px" onclick="cancel()" >Cancel </button>

                    <div id="final_thanks" style="display:none;max-width:70%">
                        <p style="text-align:center;"><b>Thank you for your review!</b><br><br> You are helping other customers make informed choices about where they eat to protect their health.<br><br>Note: Your review may take a few moments to appear if you search for it.</p>
                        
                    </div>

                    <form id="log_rating" style="display:none">
                        <input type="input" value = "" id="log_rest_id" name="rest_id"><br>
                        <input type="input" value = "" id="log_stars" name="a_rating"><br>
                        <input type="input" value = "" id="log_comment" name="com"><br>
                        
                    </form> 
                    <p id="space_review"></p>

                </div>
                
                
                
                
                
                
                
                <div id="about_div" style="width:95%;display:none;" >
                    <h2><b>How to help</b></h2>
                    <ul class="a">
                      <li>Wear a mask inside buildings</li>
                      <li>Remain 6 feet away from staff and customers</li>
                      <li>Order contactless delivery or pickup</li>
                      <li>Wash your hands and use hand sanitizer</li>
                    </ul>
                    <h2><b>Background and credits</b></h2>
                    <p id="about_1" style="text-align: justify;">Dining with 'Rona puts the power back in peoples' hands to make conscientious choices about where to eat. By reviewing and reading reviews, customers can support small businesses that are doing their best to follow safe practices to fight the spread of coronavirus. Other customers can read reviews to safely dine in the time of coronavirus.</p> 
                    <p id="about_2" style="text-align: justify;">This website was coded by Clare Heinbaugh and Emilio Luz-Ricca. Art was created by Ellie Callahan, and Eleanor Heinbaugh helped with design.</p>
                    <p>
                        <i class="fas fa-people-arrows" style="font-size:40px;color:#de142b;pointer-events: none;"></i>
                        &nbsp &nbsp &nbsp
                        <i class="fas fa-head-side-mask" style="font-size:40px;color:#de142b;pointer-events: none;"></i>
                        &nbsp &nbsp &nbsp
                        <i class="fas fa-hand-sparkles" style="font-size:40px;color:#de142b;pointer-events: none;"></i>
                    </p>
                    <p id="space_about"></p>

                    
                </div>
        
            </div>
            
            <div id="entire_bottom">
                <div class="navbar_bottom">
                  <a onclick="option2()" href="#" id="opt2_b" style="background-color:#a9e3ff"><i style="color:#000;font-size:40px" class="fa fa-pencil-square-o" aria-hidden="true"></i></a>
                  <a onclick="option1()" href="#" id="opt1_b" style="background-color:#fae205"><i style="color:#000;font-size:40px" class="fa fa-search" aria-hidden="true"></i></a>
                  <a onclick="option3()" href="#" id="opt3_b" style="background-color:#a9e3ff"><i style="color:#000;font-size:40px" class="fa fa-info" aria-hidden="true"></i></a>
                  <br>
                  {{!--<div style="width:100%;height:70px;background-color:#ffffff"></div>--}}

                </div>
            </div>

    {{!-----------------------------------------------------------}}
    {{!-----------------------------------------------------------}}
    {{!-----------------------------------------------------------}}
    {{!-----------------------------------------------------------}}
    {{!-----------------------------------------------------------}}

        
    {{!--<!--LOAD JQUERY-->--}}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script type = "text/javascript">
        var fixed = document.getElementById('entire_bottom');

        fixed.addEventListener('touchmove', function(e) {

                e.preventDefault();
        
        }, false);
        
        var clare_h = screen.height
        

        // var view_height = Math.trunc(screen.height);
                
        // var new_string = ""
        // for(let i = 0; i < Math.trunc(view_height/50); i++){
        //     new_string +="<br>";
        // }
        // var myDiv1h = document.getElementById("space_search");
        // myDiv1h.innerHTML = new_string;
        
        // var new_string = ""
        // var myDiv2 = document.getElementById("space_review");
        // for(let j = 0; j < Math.trunc(view_height/60); j++){
        //     new_string +="<br>";
        // }
        // myDiv2.innerHTML = new_string;
                
        // new_string = ""
        // var myDiv3 = document.getElementById("space_about");
        // for(let k = 0; k < Math.trunc(view_height/180); k++){
        //     new_string +="<br>";
        // }
        // myDiv3.innerHTML = new_string;
                

        
        document.getElementById("review_div").style.display="none";
        document.getElementById("about_div").style.display="none";
        
        function option1(){
            resetReview()
            resetSearch()
            document.getElementById("search_div").style.display="inline-block";
            document.getElementById("review_div").style.display="none";
            document.getElementById("about_div").style.display="none";
            document.getElementById("opt1").style.backgroundColor="#fae205";
            document.getElementById("opt2").style.backgroundColor="#a9e3ff";
            document.getElementById("opt3").style.backgroundColor="#a9e3ff";
            document.getElementById("opt1_b").style.backgroundColor="#fae205";
            document.getElementById("opt2_b").style.backgroundColor="#a9e3ff";
            document.getElementById("opt3_b").style.backgroundColor="#a9e3ff";
        }
        
        function option2(){
            resetReview()
            resetSearch()
            document.getElementById("search_div").style.display="none";
            document.getElementById("review_div").style.display="inline-block";
            document.getElementById("about_div").style.display="none";
            document.getElementById("opt1").style.backgroundColor="#a9e3ff";
            document.getElementById("opt2").style.backgroundColor="#fae205";
            document.getElementById("opt3").style.backgroundColor="#a9e3ff";    
            document.getElementById("opt1_b").style.backgroundColor="#a9e3ff";
            document.getElementById("opt2_b").style.backgroundColor="#fae205";
            document.getElementById("opt3_b").style.backgroundColor="#a9e3ff"; 
            
        }
        
        function option3(){
            resetReview()
            resetSearch()
            document.getElementById("search_div").style.display="none";
            document.getElementById("review_div").style.display="none";
            document.getElementById("about_div").style.display="inline-block";
            document.getElementById("opt1").style.backgroundColor="#a9e3ff";
            document.getElementById("opt2").style.backgroundColor="#a9e3ff";
            document.getElementById("opt3").style.backgroundColor="#fae205";
            document.getElementById("opt1_b").style.backgroundColor="#a9e3ff";
            document.getElementById("opt2_b").style.backgroundColor="#a9e3ff";
            document.getElementById("opt3_b").style.backgroundColor="#fae205";
        }
        
        
        //allow user to search by pressing the enter key 
        function doIt(event) {
              var x = event.keyCode;
              if (x == 13) {  
                enter();
            }
        }
        
        ///////////////////////////////////////////////////////////////////////////////
        ////Search functionality///////
        ///////////////////////////////////////////////////////////////////////////////
        var replace_in_button = [];
        var all_comments = {};
        var all_button_rest_ids = {};
        var sort_buttons = {};
        
        function enter(){
            replace_in_button = [];
            
            const myNode = document.getElementById("choose_a_restaurant");
            myNode.innerHTML = ''
            
            document.getElementById("enter").style.display = "none";
            document.getElementById("my_loader").style.display = "inline-block";
            document.getElementById("reload_button").style.display = "inline-block"
            
            var myDiv = document.getElementById("my_list")
            myDiv.innerHTML="";
            
            
            $.ajax({
                url: "nearby_restaurants", 
                type: "get",     
                data:  $('#zipcode_entered').serialize(), //serialize form and pass to server
                success: function(response) {
                        document.getElementById("my_loader").style.display = "none";
                        document.getElementById("enter").style.display = "inline-block";
                        document.getElementById("reload_button").style.display = "none"

                        if(response==="Invalid"){
                            var myDiv = document.getElementById("my_list")
                            myDiv.innerHTML="Invalid zipcode.<br>Please enter a valid, 5-digit zipcode.";
                        }
                        else if(response===""){
                            var myDiv = document.getElementById("my_list")
                            myDiv.innerHTML="No results of search."; 
                        }
                        else{
                            list_restaurants(response)
                        }
                    },
                    error: function (stat, err) {
                        console.log("error")
                    }       
                });
            }
        
        function list_restaurants(resp){

            all_rests_fancy = []
            
            list_of_rests = (resp.split("`"));
            nice_format = ""
            for(let h = 0; h < list_of_rests.length; h++){
                cur_rest = list_of_rests[h].split("~");
                my_rest_fancy = []
                for(let r = 0; r < cur_rest.length; r++){
                    nice_format += cur_rest[r]+"<br>";
                    my_rest_fancy.push(cur_rest[r])
                }
                all_rests_fancy.push(my_rest_fancy)
            }
            
            for(let q = 0; q<all_rests_fancy.length; q++){
                var myButton = document.createElement("button");        // Create a new button 
                myButton.setAttribute('class', 'buttonFancy');
                myButton.setAttribute("id","button"+q);
                myButton.style.background='#de142b';
                myButton.style.color='#ffffff';
                // all_button_rest_ids[all_rests_fancy[q][2]] = "";

                myButton.addEventListener('click', function(){
                    work(all_rests_fancy[q][2], this.id);
                });
                sort_buttons[myButton] = rate(all_rests_fancy, myButton.id)
                
                
                document.getElementById("choose_a_restaurant").appendChild(myButton);     // Append button to <div> with id="queried_restaurants"
            }
            

    }
    
    //var previous_button = "button0"
    
    
    function work(restaurant_id, my_id){
        
        //only allow user to open one button at a time
        if(replace_in_button.length > 0){
            var prevButton = document.getElementById(replace_in_button[0]);
            prevButton.innerHTML = replace_in_button[1];
            replace_in_button = [];
            var aButton = document.getElementById(my_id);
            var delete_stuff = aButton.innerHTML.split("<div id=\"special_secrets\">")[0];
        
            replace_in_button.push(my_id);
            replace_in_button.push(delete_stuff);
        }
        else{
            var bButton = document.getElementById(my_id);
            
            replace_in_button.push(my_id);
            replace_in_button.push(bButton.innerHTML);
        }
        
        // var the_url = all_button_rest_ids[restaurant_id]
        // alert(JSON.stringify(all_button_rest_ids))
        
        //code to get and output restaurant URL; right now lags A LOT; 
        // $.ajax({
        //         url: "get_URL", 
        //         type: "get",     
        //         data:  $('#id_entered').serialize(), //serialize form and pass to server
        //         success: function(response) {
        //                 the_url = response
                        
        //             },
        //             error: function (stat, err) {
        //                 console.log("error")
        //             }       
        //     });
        
        
        
        if(restaurant_id in all_comments){
            //show the comments and all get the link
            var myShowyButton = document.getElementById(my_id);
            // var currentText = myShowyButton.innerHTML
            myShowyButton.innerHTML += "<div style=\"text-align:left;\" id=\"special_secrets\"><br><br><br><div style=\"text-align:left;word-wrap: break-word;\"><b>Customer feedback:</b><br>"+all_comments[restaurant_id]+"</div></div>";
    
        }
        else{
            //show the comments and all get the link
            var myShowyButton = document.getElementById(my_id);
            myShowyButton.innerHTML += "<div id=\"special_secrets\"><br><br><b>Customer feedback:</b><br>No reviews yet.</div>";
        }
        
        
        
    }
    
    
    // function add_urls(){
    //     for (var key in all_button_rest_ids){
    //         var myDiv = document.getElementById("url");
    //         myDiv.value = key;
    //         $.ajax({
    //             url: "get_URL", 
    //             type: "get",     
    //             data:  $('#id_entered_part_2').serialize(), //serialize form and pass to server
    //             success: function(response) {
    //                     all_button_rest_ids[key] = response
    //                 },
    //                 error: function (stat, err) {
    //                     console.log("error")
    //                 }       
    //         });
    //     }
    // }
    
    //get the current rating
    function rate(allRests,my_id){
        //determine the current value 
        var the_number = parseInt(my_id.split("n")[1]);
        
        var aDiv = document.getElementById("print");
        aDiv.value = allRests[the_number][2];
        
        $.ajax({
            url: "get_a_restaurant", 
            type: "get",     
            data:  $('#id_entered').serialize(), //serialize form and pass to server
            success: function(response) {
                
                // var myDiv = document.getElementById("print");
                // myDiv.value = response;
                
                //if there are no existing ratings and comments
                if(response==="None"){
                    var mySecondDiv = document.getElementById(my_id);
                    mySecondDiv.innerHTML = "<div class=\"bro\" style=\"text-align:center\">"+allRests[the_number][0]+"</div>"+allRests[the_number][1];
                    return 0;
                    
                }
                //if there are ratings and comments
                else{
                    var rating_and_comment = response.split("^");
                    var rat = rating_and_comment[0];
                    var coms = rating_and_comment[1].split("~");
                    var coms_pretty = "";
                    coms_pretty+="<ul class=\"b\">";
                    for(let g = 0; g<coms.length; g++){
                        coms_pretty += "<li>"+coms[g]+"</li>";
                    }
                    coms_pretty+="</ul>";
                    all_comments[allRests[the_number][2]] = coms_pretty

                    var array_of_stars = all_the_stars(rat);
                    var star_string = "<i class=\""+array_of_stars[0]+"\"></i><i class=\""+array_of_stars[1]+"\" ></i><i class=\""+array_of_stars[2]+"\" ></i><i class=\""+array_of_stars[3]+"\" ></i><i class=\""+array_of_stars[4]+"\"></i>"
                    //alert(star_string);
                    
                    var mySecondDiv = document.getElementById(my_id);
                    mySecondDiv.innerHTML = "<div style=\"text-align: center;\"><div class=\"left_floater\"><div class=\"bro\">"+allRests[the_number][0]+"</div>"+
                    allRests[the_number][1]+"</div>"+"<div class=\"right_floater\">"+star_string+"</div></div>";
                    //mySecondDiv.innerHTML = "<p>hello world</p>"//"<p style=\"text-align: left;\">Hello world</p>"
                    
                    return parseInt(rat)
                    
                }
                
            },
            error: function (stat, err) {
                console.log("error")
                return 0;
            }       
        });
        return 0;

    }

    function all_the_stars(floatieBoi){
        var rounded_val = Math.round(floatieBoi*2)/2;
        
        var lovely_stars = []
        if(rounded_val==0){
            lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");
        }
        else if(rounded_val==0.5){
            lovely_stars.push("fa fa-star-half-alt");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");
        }
        else if(rounded_val==1){
            lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");
        }
        else if(rounded_val==1.5){
            lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star-half-alt");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");
        }
        else if(rounded_val==2){
            lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");
        }
        else if(rounded_val==2.5){
            lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star-half-alt");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");
        }
        else if(rounded_val==3.0){
            lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star-o");lovely_stars.push("fa fa-star-o");
        }
        else if(rounded_val==3.5){
            lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star-half-alt");lovely_stars.push("fa fa-star-o");
        }
        else if(rounded_val==4){
            lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star-o");
        }    
        else if(rounded_val==4.5){
            lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star-half-alt");
        } 
        else{
            lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");lovely_stars.push("fa fa-star");
        } 
        return lovely_stars;
    }
    
    function resetSearch(){
        var div1 = document.getElementById("zipcode");
        var div2 = document.getElementById("next_page_token");
        var div3 = document.getElementById("print");
        var div4 = document.getElementById("choose_a_restaurant");
        var div5 = document.getElementById("my_list");
        
        div1.value = "";
        div2.value = "";
        div3.value = "";
        div4.innerHTML = '';
        div5.innerHTML = "";
        
    }  
    
    ///////////////////////////////////////////////////////////////////////////////
    ////Review functionality///////
    ///////////////////////////////////////////////////////////////////////////////

    //global variables for restaurant identification
    selected_restaurant_name = "None" 
    selected_restaurant_id = "None" 
     
    document.getElementById("rating_system").style.display="none";
    document.getElementById("complete_review").style.display="none";
        
     function picked(){
        var anotherDiv = document.getElementById("one_search_results")
        anotherDiv.innerHTML=""; 

         
         if(document.getElementById("one_restaurant").value==""){
            var zeDiv = document.getElementById("one_search_results")
            zeDiv.innerHTML="Please enter a restaurant name."; 
         }
         else{
             document.getElementById("select_my_restaurant").style.display = "none";
             document.getElementById("my_loader_2").style.display = "inline-block";
             document.getElementById("reload_button2").style.display = "inline-block";
             
             $.ajax({
                url: "search_name", 
                type: "get",     
                data:  $('#my_one_restaurant').serialize(), //serialize form and pass to server
                success: function(response) {
                        document.getElementById("select_my_restaurant").style.display = "inline-block";
                        document.getElementById("my_loader_2").style.display = "none";
                        document.getElementById("reload_button2").style.display = "none";

                        const myNode = document.getElementById("queried_restaurants");
                        myNode.innerHTML = ''
                        if(response==="Invalid"){
                            var myDiv = document.getElementById("one_search_results")
                            myDiv.innerHTML="Invalid zipcode.<br>Please enter a valid, 5-digit zipcode."; 
                        }
                        else if(response===""){
                            var myDiv = document.getElementById("one_search_results")
                            myDiv.innerHTML="No results of search."; 
                        }
                        else{
                            var myDiv = document.getElementById("one_search_results")
                            myDiv.innerHTML=""; 
                            createOptions(response);
                        }
                    },
                    error: function (stat, err) {
                        console.log("error")
                    }       
            });
         }
            

        }
    
    function createOptions(resp){
        
        all_rests_fancy = []
        
        list_of_rests = (resp.split(";"));
        nice_format = ""
        for(let h = 0; h < list_of_rests.length; h++){
            cur_rest = (list_of_rests[h]).replace("\"", "'").replace("\"", "'").split("', '");
            my_rest_fancy = []
            for(let r = 0; r < cur_rest.length; r++){
                nice_format+= cur_rest[r].replace("'", "").replace("(", "").replace(")", "").replace("(", "")+"<br>"
                my_rest_fancy.push(cur_rest[r].replace("'", "").replace("(", "").replace(")", "").replace("(", ""))
            }
            all_rests_fancy.push(my_rest_fancy)
        }
        
        // var myDiv = document.getElementById("one_search_results")
        // myDiv.innerHTML=all_rests_fancy[0]+"";
        
        for(let q = 0; q<all_rests_fancy.length; q++){
            var myButton = document.createElement("button");        // Create a new button 
            myButton.innerHTML = all_rests_fancy[q][0]+"<br>"+all_rests_fancy[q][1]+"";                // Insert text
            myButton.setAttribute('class', 'buttonFancy');
            myButton.setAttribute('id', ('button'+q));
            myButton.style.background='#de142b';
            myButton.style.color='#ffffff';
            myButton.addEventListener('click', function(){
                review(all_rests_fancy[q]);
            });
            document.getElementById("queried_restaurants").appendChild(myButton);     // Append button to <div> with id="queried_restaurants"
            
        }

    }
    
    function review(a_restaurant){
        document.getElementById("restaurant-selector").style.display="none";
        document.getElementById("rating_system").style.display="inline-block";
        document.getElementById("cancel_button").style.display="inline-block";
        document.getElementById("stars").style.display="inline-block";
        selected_restaurant_id = a_restaurant[(a_restaurant.length-1)];
        selected_restaurant_name = a_restaurant[0] 
    }
    
    
        
     var questions_array = [
         "<i class=\"fas fa-people-arrows\"></i> <br> <br><b>Social Distancing</b>", // <br> <ul class = \"a\"><li>How well did people stay 6-feet apart?</li> <li>Were there few people inside the building at a time?</li> <li>Was it clear where to stand or wait to avoid other people?</li> <li>Were there glass or plastic separators between you and members of the staff? </li><li>In general, how well was social distancing exhibited?</li></ul> ",
         "<i class=\"fas fa-head-side-mask\"></i> <br> <br><b>Masks</b>", // <br> <ul class = \"a\"><li>Were members of the staff wearing masks?</li> <li>Did other customers wear masks?</li> <li>Was it clear where to stand or wait to avoid other people?</li> <li>Did you notice any signs posted encouraging or requiring customers to wear masks?</li></ul>",
         "<i class=\"fas fa-hand-sparkles\"></i> <br><br><b>General Hygiene</b>", //<br> <ul class = \"a\"><li>How clean was it in general?</li> <li>Were surfaces wiped down?</li> <li>Was there a way to avoid frequently touched surfaces like door handles?</li></ul>",
         //"<div ng-app=""><p>Input something in the input box:</p><p>Name : <input type=\"text\" ng-model=\"name\" placeholder=\"Enter name here\"></p><h1>{{name.length}}</h1></div>"
         ""
     
     ]
     
        var answers_array = []
        
          ////////question 1
          const stars=document.querySelector(".ratings").children;
          let index;

          var c = 0;
          var myDiv = document.getElementById("questions")
          myDiv.innerHTML = questions_array[c] 
          
          
          for(let i=0; i<stars.length; i++){
            stars[i].addEventListener("mouseover",function(){
                for(let j=0; j<stars.length; j++){
                    stars[j].classList.remove("fa-star");		 	
                    stars[j].classList.add("fa-star-o");		 	
                 }
                 for(let j=0; j<=i; j++){
                    stars[j].classList.remove("fa-star-o");		 	
                   stars[j].classList.add("fa-star");		 	
                 }
            })
            stars[i].addEventListener("click",function(){
                var millisecondsToWait = 500;
                
                for(let j=0; j<stars.length; j++){
                    stars[j].classList.remove("fa-star");		 	
                    stars[j].classList.add("fa-star-o");		 	
                 }
                
                answers_array.push((i+1));
                // index=-1; //sets all stars back to empty
              
                var myDiv = document.getElementById("questions");
                c++;
                myDiv.innerHTML = questions_array[c];
                
                var theDiv = document.getElementById("thank-you");
                theDiv.innerHTML = (c+1)+" of 4 questions"
                
                
                if(c==questions_array.length-1){
                    var yet_another_freaking_div = document.getElementById("comment_for_reviews")
                    yet_another_freaking_div.style.display = "inline-block"
                    finish_review()
                }
                else{
                    
                }

            })
            stars[i].addEventListener("mouseout",function(){

                 for(let j=0; j<stars.length; j++){
                    stars[j].classList.remove("fa-star");		 	
                    stars[j].classList.add("fa-star-o");		 	
                 }
                 for(let j=0; j<=index; j++){
                   stars[j].classList.remove("fa-star-o");		 	
                   stars[j].classList.add("fa-star");		 	
                 }
            })
          } 
        
        function finish_review(){
            console.log(answers_array);
            // var message = document.getElementById("thank-you");
            // message.innerHTML = answers_array;
            
            //selected_restaurant_id is the id of the review restaurant-selector
            var div1 = document.getElementById("log_rest_id")
            div1.value = selected_restaurant_id;
            
            //first 3 elements of answers_array are star ratings that need to be averaged
            var sum = 0;
            for(let x = 0; x<(answers_array.length); x++){
                sum += answers_array[x];
            }
            document.getElementById("log_stars").value = (sum/3).toString();
            document.getElementById("stars").style.display="none";
            document.getElementById("complete_review").style.display="inline-block";

        }
        
        //function if submit is selected on last page of review
        
        function submit(){
            //get the comments
            document.getElementById("log_comment").value = document.getElementById("myTextArea").value;
            
            var message = document.getElementById("thank-you");
            
            var a_new_div = document.getElementById("log_comment")
                
            //check if too long of a comment
            if(document.getElementById("log_comment").value.length > 100){
                message.innerHTML = "Max of 100 characters.";
            }
            else if(profanity(a_new_div.value)){
                message.innerHTML = "Please avoid profanity.";
            }
            else{
                $.ajax({
                    url: "store_rating", 
                    type: "get",     
                    data:  $('#log_rating').serialize(), //serialize form and pass to server
                    success: function(response) {
                            document.getElementById("log_stars").value = response;
    
                        },
                        error: function (stat, err) {
                            console.log("error")
                    }       
                });
            
                resetReview()
                document.getElementById("final_thanks").style.display="inline-block";
                document.getElementById("restaurant-selector").style.display="none";


            }
        }
        
        //function if cancel is selected on last page of review
        function cancel(){
            resetReview()
        }
        
        //reset all elements before next review
        function resetReview(){
            const myNode = document.getElementById("queried_restaurants");
            myNode.innerHTML = ''
            document.getElementById("restaurant-selector").style.display="inline-block";
            document.getElementById("cancel_button").style.display="none";
            document.getElementById("rating_system").style.display="none";
            document.getElementById("complete_review").style.display="none";
            document.getElementById("final_thanks").style.display="none";
            document.getElementById("comment_for_reviews").style.display="none";
            document.getElementById("myTextArea").value = "";

            answers_array = []
            c = 0
            var myDiv = document.getElementById("questions")
            myDiv.innerHTML = questions_array[c] 
            document.getElementById("one_restaurant").value="";
            document.getElementById("one_zipcode").value="";
            var yetAnotherDiv = document.getElementById("thank-you");
            yetAnotherDiv.innerHTML = "1 of 4 questions";
            var divBoi = document.getElementById("one_search_results");
            divBoi.innerHTML = ""; 
        }
        
        //////////////////////////////////////
        /////////////General methods//////////
        
        function profanity(myString){
            return false; //swearjar.censor(myString)
        }
        
        function refresh(callback){
            location.reload();
            callback();
        }
        
        function reset_1(){
            option1();
        }
        
        function reset_2(){
            option2();
        }
        
        function reload(){
            refresh(reset_1);
        }
        
        function reload2(){
            refresh(reset_2);
        }
        
        
    </script>

        
        
    </body>
</html>
